<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extractor de Códigos BX</title>
    <!-- Cargamos Tailwind CSS desde la CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Usamos la fuente Inter, que es moderna y limpia */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Un pequeño estilo para la barra de scroll en el área de resultados */
        #results-list::-webkit-scrollbar {
            width: 8px;
        }
        #results-list::-webkit-scrollbar-track {
            background: #374151; /* gray-700 */
            border-radius: 10px;
        }
        #results-list::-webkit-scrollbar-thumb {
            background: #4B5563; /* gray-600 */
            border-radius: 10px;
        }
        #results-list::-webkit-scrollbar-thumb:hover {
            background: #6B7280; /* gray-500 */
        }
    </style>
    <!-- Importamos la fuente Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <!-- Notificación de copiado (oculta por defecto) -->
    <div id="copy-notification" class="fixed top-5 left-1/2 -translate-x-1/2 z-50 bg-green-500 text-white py-2 px-5 rounded-lg shadow-xl transition-all duration-300 opacity-0 transform -translate-y-10">
        ¡Código copiado al portapapeles!
    </div>

    <!-- Contenedor principal de la App -->
    <main class="bg-gray-800 p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-2xl space-y-6">
        
        <header>
            <h1 class="text-2xl font-bold text-center text-white">Extractor de Códigos BX</h1>
            <p class="text-center text-gray-400">Pega tu texto y extrae los códigos que empiezan con "BX".</p>
        </header>

        <!-- Área de Texto de Entrada -->
        <div class="space-y-2">
            <label for="text-input" class="block text-sm font-medium text-gray-300">Pega tu texto aquí:</label>
            <textarea
                id="text-input"
                rows="8"
                class="w-full p-4 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-shadow duration-200"
                placeholder="Ejemplo: El código BX12345 está activo, pero el BX67890 no..."
            ></textarea>
        </div>

        <!-- Botón de Acción y Checkbox de Acumular -->
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <button
                id="extract-btn"
                class="w-full sm:w-auto bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-800"
            >
                Extraer Códigos
            </button>
            
            <div class="flex items-center justify-end sm:justify-center">
                <input
                    id="accumulate-toggle"
                    type="checkbox"
                    class="h-4 w-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"
                >
                <label for="accumulate-toggle" class="ml-2 text-sm font-medium text-gray-300">
                    Acumular resultados
                </label>
            </div>
        </div>

        <!-- Área de Resultados -->
        <div class="space-y-4">
            <!-- Contenedor para el título, contador y botón "Copiar Todos" -->
            <div class="flex justify-between items-center gap-4">
                <!-- Título y Contador -->
                <div class="flex items-center flex-wrap gap-2">
                    <h2 class="text-lg font-semibold text-white">Resultados:</h2>
                    <!-- NUEVO: Contador de BX -->
                    <span id="bx-counter" class="text-sm font-medium bg-blue-200 text-blue-800 px-2.5 py-0.5 rounded-full">Total: 0</span>
                </div>
                
                <button
                    id="copy-all-btn"
                    class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors duration-200 text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-gray-800 flex-shrink-0"
                >
                    Copiar Todos
                </button>
            </div>
            
            <div
                id="results-list"
                class="w-full h-64 bg-gray-900 border border-gray-700 rounded-lg p-4 overflow-y-auto space-y-2"
            >
                <!-- Los resultados se insertarán aquí dinámicamente -->
                <p id="placeholder-text" class="text-gray-500">Aún no hay resultados. Pega tu texto y presiona "Extraer".</p>
            </div>
        </div>
    </main>

    <script>
        // --- 1. Referencias a Elementos del DOM ---
        const textInput = document.getElementById('text-input');
        const extractBtn = document.getElementById('extract-btn');
        const resultsList = document.getElementById('results-list');
        const placeholderText = document.getElementById('placeholder-text');
        const copyNotification = document.getElementById('copy-notification');
        const copyAllBtn = document.getElementById('copy-all-btn');
        const accumulateToggle = document.getElementById('accumulate-toggle');
        
        // --- NUEVA Referencia al Contador ---
        const bxCounter = document.getElementById('bx-counter');

        // --- 2. Función para Copiar al Portapapeles ---
        function copyToClipboard(text, successMessage) {
            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = text;
            tempTextarea.style.position = 'fixed';
            tempTextarea.style.left = '-9999px';
            document.body.appendChild(tempTextarea);
            
            tempTextarea.select();
            try {
                document.execCommand('copy');
                const msg = successMessage || `¡Copiado: ${text}!`;
                showNotification(msg);
            } catch (err) {
                console.error('Error al copiar:', err);
                showNotification('Error al copiar', true);
            }
            
            document.body.removeChild(tempTextarea);
        }

        // --- 3. Función para Mostrar Notificación ---
        let notificationTimeout;
        function showNotification(message, isError = false) {
            if (notificationTimeout) {
                clearTimeout(notificationTimeout);
            }
            copyNotification.textContent = message;
            copyNotification.classList.remove('bg-green-500', 'bg-red-500', 'opacity-0', '-translate-y-10');
            
            if (isError) {
                copyNotification.classList.add('bg-red-500');
            } else {
                copyNotification.classList.add('bg-green-500');
            }
            copyNotification.classList.add('opacity-100', 'translate-y-0');

            notificationTimeout = setTimeout(() => {
                copyNotification.classList.remove('opacity-100', 'translate-y-0');
                copyNotification.classList.add('opacity-0', '-translate-y-10');
            }, 2500);
        }

        // --- 4. NUEVA Función para Actualizar el Contador ---
        function updateCounter() {
            // Contamos cuántos elementos con el atributo 'data-code' hay en la lista
            const count = resultsList.querySelectorAll('[data-code]').length;
            bxCounter.textContent = `Total: ${count}`;
        }

        // --- 5. Event Listener para el Botón "Extraer" (Actualizado) ---
        extractBtn.addEventListener('click', () => {
            const inputText = textInput.value;
            const accumulate = accumulateToggle.checked;
            
            const regex = /\bBX\S+/g;
            const matches = inputText.match(regex);

            if (!accumulate) {
                resultsList.innerHTML = '';
            }

            if (matches && matches.length > 0) {
                const existingCodes = new Set(
                    Array.from(resultsList.querySelectorAll('[data-code]')).map(el => el.dataset.code)
                );
                const uniqueNewMatches = [...new Set(matches)];

                if (placeholderText.parentElement === resultsList) {
                    placeholderText.remove();
                }

                uniqueNewMatches.forEach(match => {
                    if (!existingCodes.has(match)) {
                        const item = document.createElement('div');
                        item.textContent = match;
                        item.dataset.code = match; // Usamos data-attribute para contarlos
                        
                        item.className = 'p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors duration-150 text-white font-mono';
                        
                        item.addEventListener('click', () => {
                            copyToClipboard(match, `¡Copiado: ${match}!`);
                        });
                        
                        resultsList.appendChild(item);
                    }
                });

                if (accumulate) {
                    textInput.value = '';
                }

            } else {
                if (resultsList.children.length === 0) {
                    resultsList.appendChild(placeholderText);
                    placeholderText.textContent = 'No se encontraron códigos "BX" en este texto.';
                }
            }

            if (resultsList.children.length === 0) {
                resultsList.innerHTML = '';
                resultsList.appendChild(placeholderText);
                placeholderText.textContent = 'Aún no hay resultados.';
            }

            // --- LLAMAMOS A LA FUNCIÓN DEL CONTADOR ---
            // Se llama al final para que cuente el total después de añadir o limpiar
            updateCounter();
        });

        // --- 6. Event Listener para el Botón "Copiar Todos" ---
        copyAllBtn.addEventListener('click', () => {
            const allCodes = Array.from(resultsList.querySelectorAll('[data-code]'))
                                .map(el => el.dataset.code);

            if (allCodes.length === 0) {
                showNotification('No hay códigos en la lista para copiar.', true);
                return;
            }

            const textToCopy = allCodes.join('\n');
            copyToClipboard(textToCopy, `¡Copiados ${allCodes.length} códigos!`);
        });

    </script>
</body>
</html>